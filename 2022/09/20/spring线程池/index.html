<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="featherain">


    <meta name="subtitle" content="Welcome">




<title>Springçº¿ç¨‹æ±  | featherainçš„ä¸ªäººç«™</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 5.4.2"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">featherain&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">å…¨éƒ¨</a>
                
                    <a class="menu-item" href="/category">åˆ†ç±»</a>
                
                    <a class="menu-item" href="/tag">æ ‡ç­¾</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">featherain&#39;s Blog</a><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">å…¨éƒ¨</a>
                
                    <a class="menu-item" href="/category">åˆ†ç±»</a>
                
                    <a class="menu-item" href="/tag">æ ‡ç­¾</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">å±•å¼€æ‰€æœ‰</a>
        <a onclick="go_top()">è¿”å›é¡¶éƒ¨</a>
        <a onclick="go_bottom()">ç›´è¾¾åº•éƒ¨</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6;    // ä¸º 6 æ—¶å±•å¼€æ‰€æœ‰
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function () {
            tocbot.refresh(obj_merge(tocbot_default_config, { hasInnerContainers: true }));
        }, 420); // è¿™ä¸ªå€¼æ˜¯ç”± tocbot æºç é‡Œå®šä¹‰çš„ scrollSmoothDuration å¾—æ¥çš„
    }

    document.ready(function () {
        tocbot.init(obj_merge(tocbot_default_config, { collapseDepth: 1 }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, { collapseDepth: expanded ? 1 : DEPTH_MAX }));
        b.innerText = expanded ? 'å±•å¼€æ‰€æœ‰' : 'å…¨éƒ¨æŠ˜å ';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">Springçº¿ç¨‹æ± </h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">featherain</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">ä¹æœˆ 20, 2022&nbsp;&nbsp;14:14:22</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/java/">java</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="ğŸš§ğŸš§å¿«é€Ÿçº¿ç¨‹æ± æ­å»ºä½¿ç”¨-ğŸ­å»ºè®¾ä¸­"><a href="#ğŸš§ğŸš§å¿«é€Ÿçº¿ç¨‹æ± æ­å»ºä½¿ç”¨-ğŸ­å»ºè®¾ä¸­" class="headerlink" title="ğŸš§ğŸš§å¿«é€Ÿçº¿ç¨‹æ± æ­å»ºä½¿ç”¨(ğŸ­å»ºè®¾ä¸­)"></a>ğŸš§ğŸš§å¿«é€Ÿçº¿ç¨‹æ± æ­å»ºä½¿ç”¨(ğŸ­å»ºè®¾ä¸­)</h1><h2 id="Springå°è£…çš„JDKçº¿ç¨‹æ± "><a href="#Springå°è£…çš„JDKçº¿ç¨‹æ± " class="headerlink" title="Springå°è£…çš„JDKçº¿ç¨‹æ± "></a>Springå°è£…çš„JDKçº¿ç¨‹æ± </h2><p>â€‹    springçš„iocä¸­æ˜¯å°è£…äº†ä¸€ä¸ªé»˜è®¤çš„çº¿ç¨‹æ± çš„ï¼Œå¹¶æä¾›ç»™æˆ‘ä»¬è‡ªå®šä¹‰çº¿ç¨‹æ± å¹¶äº¤ç»™iocå®¹å™¨ç®¡ç†ä½¿ç”¨çš„æ–¹æ³•ï¼Œé€šè¿‡@EnableAsyncå°±å¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œä½¿ç”¨@Asyncå°±å¯ä»¥å®šä¹‰ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ï¼Œé€šè¿‡springç»™æˆ‘ä»¬æä¾›çš„ThreadPoolTaskExecutorå°±å¯ä»¥ä½¿ç”¨çº¿ç¨‹æ± ã€‚</p>
<p>1ã€è‡ªå®šä¹‰çº¿ç¨‹æ± ä¿¡æ¯</p>
<p>â€‹    åˆ›å»ºçº¿ç¨‹æ± é…ç½®ç±»<code>ThreadPoolConfig</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableAsync;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executor;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadPoolConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean(&quot;taskExecutor&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Executor <span class="title function_">taskExecutor</span><span class="params">()</span>  &#123;</span><br><span class="line">        <span class="comment">//ThreadPoolTaskExecutoræ˜¯Executorçš„æ›¾æ›¾å­™å­</span></span><br><span class="line">        <span class="type">ThreadPoolTaskExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolTaskExecutor</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> Runtime.getRuntime().availableProcessors();<span class="comment">//è·å–åˆ°æœåŠ¡å™¨çš„cpuå†…æ ¸</span></span><br><span class="line">        <span class="comment">// è®¾ç½®çº¿ç¨‹æ± ç»´æŠ¤çš„åŸºæœ¬çº¿ç¨‹æ•°</span></span><br><span class="line">        executor.setCorePoolSize(i);</span><br><span class="line">        <span class="comment">// è®¾ç½®æœ€å¤§çº¿ç¨‹æ•°</span></span><br><span class="line">        executor.setMaxPoolSize(i*<span class="number">2</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®é˜Ÿåˆ—å®¹é‡</span></span><br><span class="line">        executor.setQueueCapacity(i*<span class="number">4</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®çº¿ç¨‹ç©ºé—²æ—¶é—´ï¼ˆç§’ï¼‰</span></span><br><span class="line">        executor.setKeepAliveSeconds(<span class="number">60</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®é»˜è®¤çº¿ç¨‹åç§°</span></span><br><span class="line">        executor.setThreadNamePrefix(<span class="string">&quot;taskExecutor-&quot;</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®æ‹’ç»ç­–ç•¥</span></span><br><span class="line">        executor.setRejectedExecutionHandler(<span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.CallerRunsPolicy());</span><br><span class="line">        executor.initialize();</span><br><span class="line">        <span class="keyword">return</span> executor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¿™ä¸ªæ‹’ç»ç­–ç•¥CallerRunsPolicyæœ‰OOMé£é™©ï¼Œä¸æ˜¯å¾ˆå»ºè®®ä½¿ç”¨ã€‚</p>
<p>â€‹    è¿™é‡Œçš„<code>ThreadPoolTaskExecutor</code>æ˜¯Springæä¾›çš„çº¿ç¨‹æ± ï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡xmlã€ymlã€propertiesçš„æ–¹å¼æ¥é…ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿™ç§é…ç½®ç±»çš„æ–¹å¼è¿›è¡Œçº¿ç¨‹æ± é…ç½®ï¼Œæˆ‘ä»¬æ¥è¯´æ˜ä¸€ä¸‹çº¿ç¨‹æ± é…ç½®ç±»å½“ä¸­å­—æ®µçš„å«ä¹‰ã€‚</p>
<p>â€‹    **<code>@Configuration</code>**ï¼šæ ‡è¯†é…ç½®ç±»ï¼Œå¹¶å°†é…ç½®ç±»æ³¨å†Œåˆ°springçš„IOCå®¹å™¨å½“ä¸­ã€‚ï¼ˆå¦‚æœä½¿ç”¨xmlå¯ä»¥ç”¨<code>@ImportResource</code>æŠŠxmlæ³¨å…¥è¿›æ¥ï¼‰</p>
<p>â€‹    **<code>@EnableAsync</code>**ï¼šå¼€å¯å¼‚æ­¥æ”¯æŒï¼Œåœ¨<code>@SpringBootApplication</code>å¯åŠ¨ç±»æˆ–è€…<code>@Configuration</code>æ³¨è§£ç±»ä¸Šæ·»åŠ ï¼Œä½¿å¾—@Asyncå¯¹æ ‡æ³¨çš„æ–¹æ³•å¼€å¯å¼‚æ­¥å¤šçº¿ç¨‹è°ƒç”¨ï¼Œspringå¯¹ä»–çš„æ³¨è§£å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>Enables Springâ€™s asynchronous method execution capability, similar to functionality found in Springâ€™s <a href="task:*">task:*</a> XML namespace.</p>
<p>To be used together with @Configuration classes as follows, enabling annotation-driven async processing for an entire Spring application context:</p>
<p>  @Configuration<br>  @EnableAsync<br>  public class AppConfig {</p>
<p>  }</p>
</blockquote>
<blockquote>
<p>å¯ç”¨ Spring çš„å¼‚æ­¥æ–¹æ³•æ‰§è¡ŒåŠŸèƒ½ï¼Œç±»ä¼¼äº Spring çš„ <a href="task:">task:</a> XML å‘½åç©ºé—´ä¸­çš„åŠŸèƒ½ã€‚</p>
<p>è¦ä¸@Configuration ç±»ä¸€èµ·ä½¿ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œä¸ºæ•´ä¸ª Spring åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡å¯ç”¨æ³¨é‡Šé©±åŠ¨çš„å¼‚æ­¥å¤„ç†ï¼š</p>
<p>  @Configuration<br>  @EnableAsync<br>  public class AppConfig {</p>
<p>  }</p>
</blockquote>
<p>â€‹    **<code>@Bean(&quot;taskExecutor&quot;)</code>**ï¼šå½“æˆ‘ä»¬åœ¨ä½¿ç”¨@Asyncæ ‡æ³¨çš„æ–¹æ³•çš„æ—¶å€™ï¼Œå¦‚æœä¸æŒ‡å®šä½¿ç”¨çš„çº¿ç¨‹æ± ï¼Œé»˜è®¤ä¼˜å…ˆä½¿ç”¨ä¸Šä¸‹æ–‡å½“ä¸­å”¯ä¸€å®šä¹‰çš„TaskExecutorç±»å‹çš„beançº¿ç¨‹æ± ï¼Œå…¶æ¬¡ä½¿ç”¨åä¸ºâ€taskExecutorâ€çš„Executorç±»å‹çš„beançº¿ç¨‹æ± ï¼Œä¿©éƒ½æ²¡æœ‰å°±ç”¨SimpleAsyncTaskExecutorå»å¤„ç†å¼‚æ­¥æ–¹æ³•è°ƒç”¨ã€‚è¿™ä¸ªåç§°å¯ä»¥è‡ªå®šä¹‰ï¼Œåªä¸è¿‡taskExecutoræ˜¯æ¯”è¾ƒç‰¹æ®Šçš„ä¸€ä¸ªè€Œå·²ï¼Œå¦‚æœæˆ‘ä»¬ç”¨taskExecutoræ ‡æ³¨äº†æˆ‘ä»¬çš„è‡ªå®šä¹‰çº¿ç¨‹æ± å°±ä¸éœ€è¦å†åœ¨@Asyncåé¢æŒ‡å®šbeanåç§°äº†ï¼Œä¸è¿‡ä¸€èˆ¬ä¹Ÿä¼šåŠ ä¸Šã€‚</p>
<blockquote>
<p>By default, Spring will be searching for an associated thread pool definition: either a unique org.springframework.core.task.TaskExecutor bean in the context, or an java.util.concurrent.Executor bean named â€œtaskExecutorâ€ otherwise. If neither of the two is resolvable, a org.springframework.core.task.SimpleAsyncTaskExecutor will be used to process async method invocations. Besides, annotated methods having a void return type cannot transmit any exception back to the caller. By default, such uncaught exceptions are only logged.</p>
</blockquote>
<blockquote>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring å°†æœç´¢å…³è”çš„çº¿ç¨‹æ± å®šä¹‰ï¼šè¦ä¹ˆæ˜¯ä¸Šä¸‹æ–‡ä¸­å”¯ä¸€çš„ org.springframework.core.task.TaskExecutor beanï¼Œè¦ä¹ˆæ˜¯åä¸ºâ€œtaskExecutorâ€çš„ java.util.concurrent.Executor beanã€‚å¦‚æœä¸¤è€…éƒ½æ— æ³•è§£æï¼Œåˆ™å°†ä½¿ç”¨ org.springframework.core.task.SimpleAsyncTaskExecutor æ¥å¤„ç†å¼‚æ­¥æ–¹æ³•è°ƒç”¨ã€‚æ­¤å¤–ï¼Œå…·æœ‰ void è¿”å›ç±»å‹çš„å¸¦æ³¨é‡Šçš„æ–¹æ³•ä¸èƒ½å°†ä»»ä½•å¼‚å¸¸ä¼ è¾“å›è°ƒç”¨è€…ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä»…è®°å½•æ­¤ç±»æœªæ•è·çš„å¼‚å¸¸ã€‚</p>
</blockquote>
<h4 id="é…ç½®é¡¹ï¼š"><a href="#é…ç½®é¡¹ï¼š" class="headerlink" title="é…ç½®é¡¹ï¼š"></a><strong>é…ç½®é¡¹</strong>ï¼š</h4><h5 id="CorePoolSizeï¼šæ ¸å¿ƒçº¿ç¨‹æ•°"><a href="#CorePoolSizeï¼šæ ¸å¿ƒçº¿ç¨‹æ•°" class="headerlink" title="CorePoolSizeï¼šæ ¸å¿ƒçº¿ç¨‹æ•°"></a><strong>CorePoolSizeï¼šæ ¸å¿ƒçº¿ç¨‹æ•°</strong></h5><p>  çº¿ç¨‹æ± ä¿æŒæ´»è·ƒçš„æœ€å°çº¿ç¨‹æ•°(æ²¡æœ‰ä»»åŠ¡éœ€è¦æ‰§è¡Œæ—¶çš„çº¿ç¨‹æ± å¤§å°)ï¼Œå› ä¸ºçº¿ç¨‹æ± é‡Œé¢çš„çº¿ç¨‹å¹¶ä¸æ˜¯çº¿ç¨‹æ± æ³¨å…¥ä¹‹åå°±å¼€å¯ï¼Œè€Œæ˜¯éœ€è¦æœ‰ä»»åŠ¡æäº¤ä¹‹åæ‰ä¼šåˆ›å»ºï¼Œå¼€å§‹çš„æ—¶å€™æ˜¯ç©ºçš„ã€‚æ‰€ä»¥å½“æˆ‘ä»¬åˆšå¯åŠ¨springä¸»ç±»æœåŠ¡ï¼Œçº¿ç¨‹æ± æ³¨å…¥ä¹‹åï¼Œå½“æˆ‘ä»¬æœ‰ä»»åŠ¡æäº¤åˆ°è¿™ä¸ªçº¿ç¨‹æ± ä¹‹åæ‰ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ”¾å…¥åˆ°çº¿ç¨‹æ± é‡Œé¢ï¼Œåœ¨çº¿ç¨‹æ´»è·ƒæ—¶é—´é‡Œçº¿ç¨‹æ± ä¼šä¸€ç›´ç»´æŠ¤CorePoolSizeä¸ªçº¿ç¨‹ï¼Œå¦‚æœè®¾ç½®allowCoreThreadTimeout=trueï¼ˆé»˜è®¤falseï¼‰æ—¶ï¼Œæ ¸å¿ƒçº¿ç¨‹ä¼šè¶…æ—¶å…³é—­ï¼Œå¦åˆ™ä¸€ç›´å­˜æ´»ã€‚</p>
<blockquote>
<p><img src="https://featherain-1302420321.cos.ap-shanghai.myqcloud.com/img/image-20220920175553025.png" alt="image-20220920175553025" loading="lazy"></p>
<p>æ ¸å¿ƒçº¿ç¨‹æ•°çš„é»˜è®¤å€¼ä¸º1</p>
</blockquote>
<h5 id="MaxPoolSizeï¼šçº¿ç¨‹æ± å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°"><a href="#MaxPoolSizeï¼šçº¿ç¨‹æ± å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°" class="headerlink" title="MaxPoolSizeï¼šçº¿ç¨‹æ± å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°"></a><strong>MaxPoolSizeï¼šçº¿ç¨‹æ± å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°</strong></h5><p>â€‹    çº¿ç¨‹æ± ä¸­çš„å½“å‰çº¿ç¨‹æ•°ç›®ä¸ä¼šè¶…è¿‡è¿™ä¸ªæ•°å€¼ã€‚å¦‚æœå·²æœ‰çº¿ç¨‹çš„ä»»åŠ¡å·²æ»¡ï¼Œå¹¶ä¸”å½“å‰çº¿ç¨‹ä¸ªæ•°å°äºmaximumPoolSizeï¼Œé‚£ä¹ˆä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚</p>
<blockquote>
<p><img src="https://featherain-1302420321.cos.ap-shanghai.myqcloud.com/img/image-20220920175750993.png" alt="image-20220920175750993" loading="lazy"></p>
<p>é»˜è®¤è®¾ç½®ä¸ºIntegerä¸Šé™ï¼Œä¹Ÿå°±æ˜¯é»˜è®¤æ— ä¸Šé™</p>
</blockquote>
<h5 id="queueCapacityï¼šä»»åŠ¡é˜Ÿåˆ—å®¹é‡ï¼ˆé˜»å¡é˜Ÿåˆ—ï¼‰"><a href="#queueCapacityï¼šä»»åŠ¡é˜Ÿåˆ—å®¹é‡ï¼ˆé˜»å¡é˜Ÿåˆ—ï¼‰" class="headerlink" title="queueCapacityï¼šä»»åŠ¡é˜Ÿåˆ—å®¹é‡ï¼ˆé˜»å¡é˜Ÿåˆ—ï¼‰"></a><strong>queueCapacityï¼šä»»åŠ¡é˜Ÿåˆ—å®¹é‡ï¼ˆé˜»å¡é˜Ÿåˆ—ï¼‰</strong></h5><p>â€‹    å½“çº¿ç¨‹æ± é‡Œé¢çš„çº¿ç¨‹æ•°é‡å¤§äºMaxPoolSizeçš„æ—¶å€™ï¼Œå°†æ–°ä»»åŠ¡æ”¾å…¥queueCapacityå¤§å°çš„é˜»å¡ä»»åŠ¡é˜Ÿåˆ—å½“ä¸­ç­‰å¾…ç©ºé—²çº¿ç¨‹ã€‚</p>
<blockquote>
<p><img src="https://featherain-1302420321.cos.ap-shanghai.myqcloud.com/img/image-20220920180126596.png" alt="image-20220920180126596" loading="lazy"></p>
<p>æ­£å€¼ä¼šæ‹¿LinkedBlockingQueueå­˜ï¼Œ0æˆ–è€…è´Ÿå€¼ä¼šå¾—åˆ°SynchronousQueue</p>
</blockquote>
<h5 id="KeepAliveSecondsï¼šçº¿ç¨‹ç©ºé—²æ—¶é—´"><a href="#KeepAliveSecondsï¼šçº¿ç¨‹ç©ºé—²æ—¶é—´" class="headerlink" title="KeepAliveSecondsï¼šçº¿ç¨‹ç©ºé—²æ—¶é—´"></a><strong>KeepAliveSecondsï¼šçº¿ç¨‹ç©ºé—²æ—¶é—´</strong></h5><p>â€‹    å¦‚æœçº¿ç¨‹åœ¨KeepAliveSecondsæ—¶é—´åæ²¡æœ‰æ–°çš„ä»»åŠ¡è¿›å…¥ï¼Œåˆ™å…³é—­çº¿ç¨‹ï¼Œè‹¥è®¾ç½®allowCoreThreadTimeout=trueåˆ™æ ¸å¿ƒçº¿ç¨‹ä¹Ÿå—æ­¤å½±å“ã€‚</p>
<blockquote>
<p><img src="https://featherain-1302420321.cos.ap-shanghai.myqcloud.com/img/image-20220920175649752.png" alt="image-20220920175649752" loading="lazy"></p>
<p>çº¿ç¨‹ç©ºé—²æ—¶é—´é»˜è®¤60s</p>
</blockquote>
<h5 id="RejectedExecutionHandlerï¼šä»»åŠ¡æ‹’ç»å¤„ç†å™¨"><a href="#RejectedExecutionHandlerï¼šä»»åŠ¡æ‹’ç»å¤„ç†å™¨" class="headerlink" title="RejectedExecutionHandlerï¼šä»»åŠ¡æ‹’ç»å¤„ç†å™¨"></a><strong>RejectedExecutionHandler</strong>ï¼šä»»åŠ¡æ‹’ç»å¤„ç†å™¨</h5><p>â€‹    å½“çº¿ç¨‹æ± çš„çº¿ç¨‹å’Œä»»åŠ¡å·²æ»¡ä¸”ä»»åŠ¡é˜Ÿåˆ—ä¹Ÿæ»¡äº†ä¹‹åï¼Œè‹¥æ˜¯è¿˜æœ‰æ–°çš„ä»»åŠ¡è¯·æ±‚ï¼Œåˆ™äº¤ç”±ä»»åŠ¡æ‹’ç»å¤„ç†å™¨å¤„ç†ï¼Œå…¶ä¸­åŒ…å«å››ç§æ‹’ç»ç­–ç•¥:</p>
<ul>
<li><p><strong>AbortPolicy</strong>ï¼šä¸¢å¼ƒä»»åŠ¡ï¼Œç›´æ¥æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ã€‚(é»˜è®¤)</p>
</li>
<li><p><strong>CallerRunsPolicy</strong>ï¼šåœ¨ä»»åŠ¡è¢«æ‹’ç»æ·»åŠ åï¼Œä¼šè°ƒç”¨å½“å‰çº¿ç¨‹æ± çš„æ‰€åœ¨çš„çº¿ç¨‹å»æ‰§è¡Œè¢«æ‹’ç»çš„ä»»åŠ¡ï¼Œä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚</p>
</li>
<li><p><strong>DiscardPolicy</strong>ï¼šç›´æ¥æŠ›å¼ƒï¼Œä»€ä¹ˆéƒ½ä¸å‘ç”Ÿã€‚</p>
</li>
<li><p><strong>DiscardOldestPolicy</strong>ï¼šæŠ›å¼ƒä»»åŠ¡é˜Ÿåˆ—ä¸­æœ€æ—§çš„ä»»åŠ¡ä¹Ÿå°±æ˜¯æœ€å…ˆåŠ å…¥é˜Ÿåˆ—çš„ï¼Œå†æŠŠè¿™ä¸ªæ–°ä»»åŠ¡æ·»åŠ è¿›å»ã€‚</p>
</li>
</ul>
<blockquote>
<p>ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥ï¼Œä¸‹é¢çš„æ–¹æ³•æºè‡ª<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/9fec2424de54">javaå¤šçº¿ç¨‹-ThreadPoolExecutorçš„æ‹’ç»ç­–ç•¥ - ç®€ä¹¦ (jianshu.com)</a></p>
<p><img src="https://featherain-1302420321.cos.ap-shanghai.myqcloud.com/img/image-20220920181436387.png" alt="image-20220920181436387" loading="lazy"></p>
</blockquote>
<blockquote>
<p>ğŸ‘‡ä¸Šé¢æ˜¯æˆ‘çš„ç†è§£ï¼Œä¸‹é¢æ˜¯æˆ‘è§‰å¾—è¯´çš„å¾ˆæ˜ç™½çš„ä¸€ä½åšä¸»å†™çš„ğŸ‘‡</p>
<p>1ã€corePoolSizeï¼šæ ¸å¿ƒçº¿ç¨‹æ•°</p>
<ul>
<li>   æ ¸å¿ƒçº¿ç¨‹ä¼šä¸€ç›´å­˜æ´»ï¼Œå³ä½¿æ²¡æœ‰ä»»åŠ¡éœ€è¦æ‰§è¡Œ</li>
<li>   å½“çº¿ç¨‹æ•°å°äºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œå³ä½¿æœ‰çº¿ç¨‹ç©ºé—²ï¼Œçº¿ç¨‹æ± ä¹Ÿä¼šä¼˜å…ˆåˆ›å»ºæ–°çº¿ç¨‹å¤„ç†ä»»åŠ¡</li>
<li>   è®¾ç½®allowCoreThreadTimeout=trueï¼ˆé»˜è®¤falseï¼‰æ—¶ï¼Œæ ¸å¿ƒçº¿ç¨‹ä¼šè¶…æ—¶å…³é—­</li>
</ul>
<p>2ã€queueCapacityï¼šä»»åŠ¡é˜Ÿåˆ—å®¹é‡ï¼ˆé˜»å¡é˜Ÿåˆ—ï¼‰</p>
<ul>
<li>å½“æ ¸å¿ƒçº¿ç¨‹æ•°è¾¾åˆ°æœ€å¤§æ—¶ï¼Œæ–°ä»»åŠ¡ä¼šæ”¾åœ¨é˜Ÿåˆ—ä¸­æ’é˜Ÿç­‰å¾…æ‰§è¡Œ</li>
</ul>
<p>3ã€maxPoolSizeï¼šæœ€å¤§çº¿ç¨‹æ•°</p>
<ul>
<li>å½“çº¿ç¨‹æ•°&gt;=corePoolSizeï¼Œä¸”ä»»åŠ¡é˜Ÿåˆ—å·²æ»¡æ—¶ã€‚çº¿ç¨‹æ± ä¼šåˆ›å»ºæ–°çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡</li>
<li>å½“çº¿ç¨‹æ•°=maxPoolSizeï¼Œä¸”ä»»åŠ¡é˜Ÿåˆ—å·²æ»¡æ—¶ï¼Œçº¿ç¨‹æ± ä¼šæ‹’ç»å¤„ç†ä»»åŠ¡è€ŒæŠ›å‡ºå¼‚å¸¸</li>
</ul>
<p>4ã€ keepAliveTimeï¼šçº¿ç¨‹ç©ºé—²æ—¶é—´</p>
<ul>
<li>å½“çº¿ç¨‹ç©ºé—²æ—¶é—´è¾¾åˆ°keepAliveTimeæ—¶ï¼Œçº¿ç¨‹ä¼šé€€å‡ºï¼Œç›´åˆ°çº¿ç¨‹æ•°é‡=corePoolSize</li>
<li>å¦‚æœallowCoreThreadTimeout=trueï¼Œåˆ™ä¼šç›´åˆ°çº¿ç¨‹æ•°é‡=0</li>
</ul>
<p>5ã€allowCoreThreadTimeoutï¼šå…è®¸æ ¸å¿ƒçº¿ç¨‹è¶…æ—¶å…³é—­<br>6ã€rejectedExecutionHandlerï¼šä»»åŠ¡æ‹’ç»å¤„ç†å™¨</p>
<ul>
<li>ä¸¤ç§æƒ…å†µä¼šæ‹’ç»å¤„ç†ä»»åŠ¡ï¼š</li>
<li>å½“çº¿ç¨‹æ•°å·²ç»è¾¾åˆ°maxPoolSizeï¼Œåˆ‡é˜Ÿåˆ—å·²æ»¡ï¼Œä¼šæ‹’ç»æ–°ä»»åŠ¡</li>
<li>å½“çº¿ç¨‹æ± è¢«è°ƒç”¨shutdown()åï¼Œä¼šç­‰å¾…çº¿ç¨‹æ± é‡Œçš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œå†shutdownã€‚å¦‚æœåœ¨è°ƒç”¨shutdown()å’Œçº¿ç¨‹æ± çœŸæ­£shutdownä¹‹é—´æäº¤ä»»åŠ¡ï¼Œä¼šæ‹’ç»æ–°ä»»åŠ¡</li>
</ul>
<ul>
<li><p>çº¿ç¨‹æ± ä¼šè°ƒç”¨rejectedExecutionHandleræ¥å¤„ç†è¿™ä¸ªä»»åŠ¡ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®é»˜è®¤æ˜¯AbortPolicyï¼Œä¼šæŠ›å‡ºå¼‚å¸¸</p>
</li>
<li><p>ThreadPoolExecutorç±»æœ‰å‡ ä¸ªå†…éƒ¨å®ç°ç±»æ¥å¤„ç†è¿™ç±»æƒ…å†µï¼š</p>
</li>
<li><p>AbortPolicy ä¸¢å¼ƒä»»åŠ¡ï¼ŒæŠ›è¿è¡Œæ—¶å¼‚å¸¸</p>
</li>
<li><p>CallerRunsPolicy æ‰§è¡Œä»»åŠ¡</p>
</li>
<li><p>DiscardPolicy å¿½è§†ï¼Œä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿ</p>
</li>
<li><p>DiscardOldestPolicy ä»é˜Ÿåˆ—ä¸­è¸¢å‡ºæœ€å…ˆè¿›å…¥é˜Ÿåˆ—ï¼ˆæœ€åä¸€ä¸ªæ‰§è¡Œï¼‰çš„ä»»åŠ¡</p>
</li>
<li><p>å®ç°RejectedExecutionHandleræ¥å£ï¼Œå¯è‡ªå®šä¹‰å¤„ç†å™¨</p>
</li>
</ul>
<p>æ¥æºï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/frankyou/p/10135212.html">ç†è§£ThreadPoolExecutorçº¿ç¨‹æ± çš„corePoolSizeã€maximumPoolSizeå’ŒpoolSize - FrankYou - åšå®¢å›­ (cnblogs.com)</a></p>
</blockquote>
<h5 id="çº¿ç¨‹æ•°é‡"><a href="#çº¿ç¨‹æ•°é‡" class="headerlink" title="çº¿ç¨‹æ•°é‡"></a>çº¿ç¨‹æ•°é‡</h5><p>â€‹    çº¿ç¨‹çš„åˆ‡æ¢ç”±CPUè¿›è¡Œï¼Œå¦‚æœå¾…æœºçº¿ç¨‹æ¯”è¾ƒå¤šï¼ŒCPUå°±è¦è¿›è¡Œæ›´å¤šçš„çº¿ç¨‹åˆ‡æ¢ï¼Œä¼šå½±å“æ‰§è¡Œæ•ˆç‡ï¼Œå¯¹äºä¸åŒçš„ä»»åŠ¡ï¼Œçº¿ç¨‹æ•°çš„è®¾ç½®ä¹Ÿä¸å°½ç›¸åŒï¼Œéœ€è¦æ ¹æ®CPUæ ¸å¿ƒæ•°Nå¯¹æœ€å¤§çº¿ç¨‹æ•°è¿›è¡Œé€‰æ‹©ï¼š</p>
<blockquote>
<p>è·å–CPUæ ¸å¿ƒæ•°Nçš„æ–¹æ³•</p>
<p>int N= Runtime.getRuntime().availableProcessors();</p>
</blockquote>
<p><strong>CPUå¯†é›†å‹ï¼š</strong></p>
<p>â€‹    æŒ‡å«æœ‰éå¸¸å¤æ‚çš„è°ƒç”¨ï¼Œå¾ªç¯æ¬¡æ•°å¾ˆå¤šï¼Œæˆ–è€…é€’å½’è°ƒç”¨å±‚æ¬¡å¾ˆæ·±æˆ–è€…å…¶ä»–å¤æ‚æƒ…å†µéœ€è¦å¤§é‡è®¡ç®—çš„ä»»åŠ¡ã€‚</p>
<p>â€‹    æ­¤æ—¶æœ€å¤§çº¿ç¨‹æ•°ä¸€èˆ¬å¯ä»¥è®¾ç½®ä¸ºN+1ä¸ªã€‚</p>
<p><strong>IOå¯†é›†å‹ï¼š</strong></p>
<p>â€‹    æŒ‡éœ€è¦é¢‘ç¹è¯»å–ç£ç›˜ä¸Šçš„æ•°æ®ï¼Œæˆ–è€…éœ€è¦é€šè¿‡ç½‘ç»œè¿œç¨‹è°ƒç”¨æ¥å£ç­‰IOæ“ä½œè¾ƒå¤šçš„ä»»åŠ¡åœºæ™¯ã€‚</p>
<p>â€‹    æ­¤æ—¶æœ€å¤§çº¿ç¨‹æ•°ä¸€èˆ¬å¯ä»¥è®¾ç½®ä¸º2Nä¸ªã€‚</p>
<blockquote>
<p>æ•°æ®æ¥æº:<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/270657575">çº¿ç¨‹æ± æœ€ä½³çº¿ç¨‹æ•°é‡åˆ°åº•è¦å¦‚ä½•é…ç½®ï¼Ÿ - çŸ¥ä¹ (zhihu.com)</a></p>
</blockquote>
<p>2ã€ä½¿ç”¨<code>CompletableFuture</code>æ‰§è¡Œçº¿ç¨‹æ± å¼‚æ­¥æ“ä½œ</p>
<p>è¿™é‡Œæ–¹ä¾¿æµ‹è¯•ç›´æ¥åœ¨controlleré‡Œå†™äº†ï¼Œå¥½å­©å­ä¸è¦å­¦</p>
<p>æ–‡ä»¶ä¸‹è½½çš„ä¸šåŠ¡ä»£ç å°è£…åˆ°Files.downloadsé‡Œé¢äº†ï¼Œç”¨çš„æ˜¯poiå†™çš„xlsxæ–‡æ¡£ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(value = &quot;/conditionsDownloadPlus&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">downloadFilePlus</span><span class="params">(HttpServletResponse response,<span class="meta">@RequestBody</span> EtpsQueryListForm etpsQueryListForm)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">    CompletableFuture&lt;Void&gt; future = CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Files.downloads(response,<span class="string">&quot;ä¼ä¸šè¯¦æƒ…æ–‡ä»¶&quot;</span>,etpsService.searchFile(etpsQueryListForm.toParam(EtpsQueryListParam.class)));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Indexquery error: files download error:&quot;</span>+e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,threadPoolTaskExecutor);</span><br><span class="line">    CompletableFuture.anyOf(future).get();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>CompletableFuture</code>ï¼š</p>
<p>â€‹    ä½¿ç”¨.get()ä¼šå°†ä¸»çº¿ç¨‹é˜»å¡ï¼Œç­‰å¾…çº¿ç¨‹ç»“æŸè¿”å›ç»“æœï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨çº¿ç¨‹æ± çš„ç›®çš„æ˜¯ä¸ºäº†åœ¨ä¸šåŠ¡ç¯å¢ƒä¸­é˜²æ­¢å¤ªå¤šipåŒæ—¶è®¿é—®æ–‡ä»¶ä¸‹è½½çš„é«˜èƒ½è€—æ¥å£å¯¼è‡´OOMï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯¹è¿™äº›éœ€è¦å ç”¨å¤§é‡å†…å­˜ç©ºé—´è¿›è¡Œæ–‡ä»¶æ“ä½œçš„æµç¨‹è¿›è¡Œæ•°é‡é™åˆ¶ï¼Œè§„å®šæœ€å¤§åŒæ—¶è¿è¡Œæ•°ï¼Œèƒ½å¤Ÿé¿å…OOMçš„æƒ…å†µå‡ºç°ã€‚</p>
<h2 id="æ–¹æ³•2ï¼šä½¿ç”¨Springbootçš„-Asyncæ ‡è¯†å¼‚æ­¥æ‰§è¡Œæ–¹æ³•"><a href="#æ–¹æ³•2ï¼šä½¿ç”¨Springbootçš„-Asyncæ ‡è¯†å¼‚æ­¥æ‰§è¡Œæ–¹æ³•" class="headerlink" title="æ–¹æ³•2ï¼šä½¿ç”¨Springbootçš„@Asyncæ ‡è¯†å¼‚æ­¥æ‰§è¡Œæ–¹æ³•"></a>æ–¹æ³•2ï¼šä½¿ç”¨Springbootçš„@Asyncæ ‡è¯†å¼‚æ­¥æ‰§è¡Œæ–¹æ³•</h2><p>â€‹    è¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯é¦–å…ˆå†™ä¸€ä¸‹çº¿ç¨‹æ± beanï¼Œä¸ä¸Šé¢ä¸€æ ·ï¼Œç„¶ååœ¨serviceå±‚å†™implæ–¹æ³•çš„æ—¶å€™åŠ ä¸Š<code>@Async(&quot;threadPoolTaskExecutor&quot;)</code>å°±å¯ä»¥äº†ï¼Œç„¶åæ³¨å…¥serviceä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œspringbootä¼šå¸®æˆ‘ä»¬å¼‚æ­¥æ‰§è¡Œè¯¥æ–¹æ³•ã€‚</p>
<p>service:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IFileService</span> &#123;</span><br><span class="line">    Future <span class="title function_">installFiles</span><span class="params">(HttpServletResponse response, String fileName, List&lt;Etps&gt; list)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ServiceImplï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Async;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IFileService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Async(&quot;threadPoolTaskExecutor&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Future <span class="title function_">installFiles</span><span class="params">(HttpServletResponse response, String fileName, List&lt;Etps&gt; list)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Files.downloads(response,fileName,list);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AsyncResult</span>(<span class="literal">true</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AsyncResult</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Controller:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">    IFileService fileService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PostMapping(value = &quot;/downloadFilePlus&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">downloadFilePlus</span><span class="params">(HttpServletResponse response,<span class="meta">@RequestBody</span> EtpsQueryListForm etpsQueryListForm)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="type">Future</span> <span class="variable">future</span> <span class="operator">=</span> fileService.installFiles(response, <span class="string">&quot;ä¼ä¸šè¯¦æƒ…æ–‡ä»¶&quot;</span>, etpsService.searchFile(etpsQueryListForm.toParam(EtpsQueryListParam.class)));</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="comment">//whileè½®è¯¢ç­‰å¾…ï¼Œè½®è¯¢é—´éš”1s</span></span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            <span class="keyword">if</span>(future.isDone())&#123;         </span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><code>Future</code>ï¼š</p>
<p><code>@Async</code>ï¼š</p>
<p>â€‹    è¿™ç§æ–¹å¼å¯ä»¥ç›´æ¥ç”¨åœ¨æ–‡ä»¶ä¸Šä¼ è¿™ç§ä¸éœ€è¦responseçš„ä¸šåŠ¡åœºæ™¯ä¸Šï¼Œå› ä¸ºåœ¨æˆ‘ä»¬è°ƒç”¨äº†è¿™ä¸ªå¼‚æ­¥æ–¹æ³•ä¹‹åå°±å¯ä»¥ç›´æ¥å…³é—­è¿æ¥äº†ï¼Œä½†æ˜¯åƒæˆ‘ä»¬è¿™ç§éœ€è¦ä½¿ç”¨responseè¿›è¡Œæ–‡ä»¶å†™å…¥çš„åœºæ™¯ï¼Œå°±éœ€è¦æˆ‘ä»¬çš„ä¸»çº¿ç¨‹åœ¨asyncæ–¹æ³•å®Œæˆä¹‹å‰ç»´æŒè¿æ¥ï¼Œä¿æŒæˆ‘ä»¬çš„responseçš„å¼€å¯çŠ¶æ€ï¼Œä½†ç°åœ¨æˆ‘åœ¨ç½‘ä¸Šæ‰¾åˆ°çš„ç­‰å¾…æ–¹æ³•å°±çº¯çº¯whileè½®è¯¢ç­‰å¾…çº¿ç¨‹isDone()ï¼Œå¦‚æœä¸æ˜¯é‚£ç§éœ€è¦å¼‚æ­¥æ“ä½œåˆ—è¡¨çš„åœºæ™¯ä½¿ç”¨è¿™ç©æ„æ„Ÿè§‰æŒºç¬¨çš„ï¼Œä¸å¦‚ç”¨æ–¹æ³•ä¸€ã€‚</p>
<h2 id="ä¸¤ç§æ–¹æ³•åŒºåˆ«å’Œè”ç³»"><a href="#ä¸¤ç§æ–¹æ³•åŒºåˆ«å’Œè”ç³»" class="headerlink" title="ä¸¤ç§æ–¹æ³•åŒºåˆ«å’Œè”ç³»"></a>ä¸¤ç§æ–¹æ³•åŒºåˆ«å’Œè”ç³»</h2><h2 id="çº¿ç¨‹å®‰å…¨"><a href="#çº¿ç¨‹å®‰å…¨" class="headerlink" title="çº¿ç¨‹å®‰å…¨"></a>çº¿ç¨‹å®‰å…¨</h2><h2 id="æ¶ˆæ¯é˜Ÿåˆ—"><a href="#æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—"></a>æ¶ˆæ¯é˜Ÿåˆ—</h2><p>â€‹    æ¶ˆæ¯é˜Ÿåˆ—æ˜¯éœ€è¦ä¸€ä¸ªæŒç»­è¿è¡Œçš„çº¿ç¨‹ç»´æŠ¤è¿™ä¸ªé˜Ÿåˆ—ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼Œåœ¨è¯¥åœºæ™¯ä¸‹çš„ç”Ÿäº§è€…æ˜¯æˆ‘ä»¬çš„fileä¸‹è½½ç±»çº¿ç¨‹ï¼Œæ¶ˆè´¹è€…å¯ä»¥çœ‹ä½œæ˜¯æˆ‘ä»¬è¿™ä¸ªæ¥å£çš„ä¸»çº¿ç¨‹ï¼Œæ‰€ä»¥åœ¨è¿™äºŒè€…ä¹‹é—´æƒ³è¦å®ç°ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå°±éœ€è¦æœ‰ä¸€ä¸ªèƒ½å¤Ÿä¸€ç›´è¿è¡Œçš„çº¿ç¨‹ï¼Œæ¯å½“æœ‰æ¥å£è¯·æ±‚ä¸‹è½½æ–‡ä»¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„controllerå»è®¿é—®è¿™ä¸ªä¸€ç›´è¿è¡Œç€çš„çº¿ç¨‹ï¼Œå»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œè¿™æ ·çœ‹æ¥å¯¹äºæ¶ˆæ¯é˜Ÿåˆ—æ¥è¯´ç”Ÿäº§è€…åº”è¯¥æ˜¯æˆ‘ä»¬çš„æ¥å£ä¸»çº¿ç¨‹ï¼Œæ¶ˆè´¹è€…æ˜¯æˆ‘ä»¬çš„fileä¸‹è½½çº¿ç¨‹ï¼Œè¿™é‡Œè¿˜éœ€è¦æœ‰ä¸€ä¸ªnotifyæœºåˆ¶ï¼Œæ¶ˆæ¯é˜Ÿåˆ—éœ€è¦å»å”¤é†’ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹å»æ¶ˆè´¹æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œåé¢è¿™ä¸ªæ¶ˆè´¹è€…å¯ä»¥å®ç°ä¸€ä¸ªçº¿ç¨‹æ± ä½†çº¿ç¨‹æ± æœ¬èº«å°±æœ‰æ ¸å¿ƒçº¿ç¨‹-ç­‰å¾…é˜Ÿåˆ—-çº¿ç¨‹çš„ä¸€ä¸ªæœºåˆ¶ï¼Œåœ¨è¿™ä¸ªç®€å•åœºæ™¯ä¸‹æ¶ˆæ¯é˜Ÿåˆ—æ²¡å•¥æ„ä¹‰ï¼Œæˆ–è€…è¯´çº¿ç¨‹æ± æœ¬èº«å°±å®ç°äº†æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p>
<p>â€‹    ç°åœ¨çš„æ¡†æ¶é‡Œé¢å·²ç»å®ç°äº†ä¸€ä¸ªrabbitMQï¼Œåœ¨</p>

        </div>

        <!-- åº•æ ä¿¡æ¯å†…å®¹ -->
        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>featherain</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>æ°¸ä¹…é“¾æ¥:</span>
                        <span><a href="https://feather-brain.github.io/2022/09/20/spring%E7%BA%BF%E7%A8%8B%E6%B1%A0/">https://feather-brain.github.io/2022/09/20/spring%E7%BA%BF%E7%A8%8B%E6%B1%A0/</a></span>
                    </p>
                
                
                    <!-- <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p> -->
                
                
                     <!-- <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>Do you believe in <strong>DESTINY</strong>?</span>
                     </p> -->
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/"># çº¿ç¨‹æ± </a>
                    
                        <a href="/tags/spring/"># spring</a>
                    
                        <a href="/tags/springboot/"># springboot</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">è¿”å›</a>
                <span>Â· </span>
                <a href="/">ä¸»é¡µ</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2022/09/20/jenkins%E6%8C%81%E7%BB%AD%E6%9E%84%E5%BB%BA/">jenkinsæŒç»­æ„å»º</a>
            
            
            <a class="next" rel="next" href="/2022/09/20/nacos%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/">nacosé…ç½®ä¸­å¿ƒ</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>Â© featherain | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>